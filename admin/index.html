<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lawrence Auto Sales – CMS</title>

  <!-- IMPORTANT: tell Decap not to auto-init -->
  <script>
    window.CMS_MANUAL_INIT = true;
  </script>

  <!-- Decap CMS (UMD) via CDN -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/decap-cms@3.9.0/dist/decap-cms.js">
  </script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0b0d10;
      color: #e8eef4;
      font: 16px/1.5 system-ui, -apple-system, BlinkMacSystemFont,
            "Segoe UI", Roboto, sans-serif;
    }
    .boot {
      height: 100%;
      display: grid;
      place-items: center;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="cms-root" class="boot">
    Loading CMS…
  </div>

  <script>
    // Single, guarded boot function to avoid double-init
    (function () {
      let booted = false;

      function boot() {
        if (booted) return;

        // Decap exposes either window.DecapCms or window.CMS
        const CMS = window.CMS || window.DecapCms;
        if (!CMS) return; // script not ready yet

        const root = document.getElementById('cms-root') || (function () {
          const el = document.createElement('div');
          el.id = 'cms-root';
          document.body.appendChild(el);
          return el;
        })();

        // IMPORTANT: point to /admin/config.yml
        CMS.init({
          config: '/admin/config.yml'
        });

        booted = true;
      }

      // Try when page finishes loading
      window.addEventListener('load', boot);
      // Fallback: try again after a short delay in case script is slow
      setTimeout(boot, 2000);
    })();
  </script>
</body>
</html>
